_pkgbasename=luajit
pkgname=lib32-${_pkgbasename}
pkgver=2.0.0
pkgrel=1
pkgdesc='A Just-In-Time Compiler for Lua'
arch=('x86_64')
url='http://luajit.org/'
license=('MIT')
depends=('gcc-multilib') 
source=(http://luajit.org/download/LuaJIT-$pkgver-rc2.tar.gz
        Makefile.patch)
md5sums=('986a71622014c7a2f8f7f64266128478'
         'c9dff2a84424fa0af322379a5f115fb7')

build() { 
    export CFLAGS="$CFLAGS -march=i686 -m32"
    export CXXFLAGS="$CXXFLAGS -march=i686 -m32"
    export LDFLAGS="$LDFLAGS -march=i686 -m32"
    export PKG_CONFIG_PATH="/usr/lib32/pkgconfig"

    cd $srcdir/LuaJIT-$pkgver
    patch -Np0 -i $srcdir/Makefile.patch
    make PREFIX=/usr
}

package() {
    cd $srcdir/LuaJIT-$pkgver
    make install DESTDIR=$pkgdir PREFIX=/usr
    rm -rf ${pkgdir}/usr/{include,share,bin}
    mv ${pkgdir}/usr/lib ${pkgdir}/usr/lib32
}
